---
created: 2022-04-28T21:28:30 (UTC +08:00)
tags: []
source: https://www.jianshu.com/p/ceed31e660b4
author: 
---

# kkFileView - 简书

> ## Excerpt
> 官网概述 https://kkfileview.keking.cn/zh-cn/docs/home.html[https://kkfileview.keking.cn/zh-...

---
## kkFileView

[![](https://upload.jianshu.io/users/upload_avatars/27705584/c3271c73-3080-4eed-a553-191165bb9ec1?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96/format/webp)](https://www.jianshu.com/u/3620b207d248)

2022.02.16 19:14:17字数 180阅读 176

## 官网概述

官网:

[https://kkfileview.keking.cn/zh-cn/docs/home.html](https://links.jianshu.com/go?to=https%3A%2F%2Fkkfileview.keking.cn%2Fzh-cn%2Fdocs%2Fhome.html)

下载地址:

https://gitee.com/kekingcn/file-online-preview/releases

-   支持word/excel/ppt/pdf等办公文档在线预览
-   其他不重要

## 前置环境

> -   CentOS7.9
> -   Java: 1.8+
> -   kkfileview v4.0.0版本\[[https://gitee.com/kekingcn/file-online-preview/releases\]](https://links.jianshu.com/go?to=https%3A%2F%2Fgitee.com%2Fkekingcn%2Ffile-online-preview%2Freleases%255D)

## 吐个槽

-   官网安装部署步骤过于简单，尝试了2台服务器，正常启动后都提示【启动office组件失败，请检查office组件是否可用】

## 安装步骤

### 1.1 安装 LiberOffice

```sh
可以尝试到 /tmp/LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS目录执行命令 yum localinstall *.rpm
然后重启kkfileview

or

或者用这个
> wget https://kkfileview.keking.cn/LibreOffice_7.1.4_Linux_x86-64_rpm.tar.gz
> tar -zxvf LibreOffice_7.1.4_Linux_x86-64_rpm.tar.gz
> cd LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS
> yum install -y *.rpm
```

### 1.2 安装中文包(该步骤可省略)

```sh
> wget https://downloadarchive.documentfoundation.org/libreoffice/old/7.1.4.2/rpm/x86_64/LibreOffice_7.1.4.2_Linux_x86-64_rpm_langpack_zh-CN.tar.gz
> 按步骤1.1操作后续, 省略
```

### 2\. 验证office服务是否安装成功

```shell
> cd /opt/libreoffice7.1/program
> ./soffice --version

=====================================================
如果顺利，此时可以看到一串版本号如下
【LibreOffice 7.1.4.2 a529a4fab45b75fefc5b6226684193eb000654f6】

否则，可能会遇到如下：
Q：【/opt/libreoffice7.1/program/soffice.bin: error while loading shared libraries: libcairo.so.2: cannot open shared object file: No such file or directory】
A：yum install -y cairo

Q：【/opt/libreoffice7.1/program/soffice.bin: error while loading shared libraries: libSM.so.6: cannot open shared object file: No such file or directory】
A：yum install -y lib

总之，缺什么装什么，直到version正常输出为止 -_-
```

### 3\. 安装kkfileview并配置

```shell
> wget https://kkfileview.keking.cn/kkFileView-4.0.0.tar.gz
> tar -zxvf kkFileView-4.0.0.tar.gz

=====================================================
默认端口为 8012, 可以在 kkFileView-4.0.0/config/application.properties 里面修改 server.port
```

### 4\. 启动并观察日志

```shell
创建日志文件
> cd kkFileView-4.0.0/log
> touch kkFileView.log

运行启动程序
> cd ../bin/
> ./startup.sh | ./showlog.sh

观察日志, kkFileView 服务启动完成
```



### 5.目录结构

```json

├── kkFileView-4.0.0
│   ├── bin #启动命令
│   │   ├── install.sh 
│   │   ├── kkFileView-4.0.0.jar
│   │   ├── showlog.sh //查看日志命令
│   │   ├── shutdown.sh //关闭命令
│   │   └── startup.sh //linux启动命令
│   ├── config #配置文件
│   │   ├── application.properties
│   │   ├── application.properties.1622137030.formatted
│   │   ├── freemarker_implicit.ftl
│   │   └── freemarker_implicit.ftl.1625627382.formatted
│   ├── file #文件上传的地方
│   │   ├── 164940908672391
│   │   │   ├── 0.jpg
│   │   │   ├── 1.jpg
│   │   │   └── 2.jpg
│   │   ├── 164940908672391.pdf
│   │   ├── 637273f6-ac1d-4f18-8b66-931acc28746e.xlsx
│   │   ├── 7b1e3f7f-75d7-4e6c-aae6-07aef969bee3.xlsx
│   │   ├── 8b8ccf61-c7f7-47e1-85a0-9469edcea42d.xlsx
│   │   ├── demo
│   │   ├── f35da9dd-80db-4d35-8620-7434e08f2a30.docx
│   │   ├── \346\265\213\350\257\225.html
│   │   ├── \346\265\213\350\257\225\ -\ \345\211\257\346\234\254.html
│   │   └── \347\273\251\346\225\210\350\200\203\350\257\204.html
│   └── log #日志文件
│       ├── kkFileView.log
│       ├── README.txt
│       └── README.txt.415106427.formatted
```



# 注意:

## 1.如果遇到这个问题

参考:https://gitee.com/kekingcn/file-online-preview/issues/I4AJGY

```shell
kkFileView-4.0.0.tar.gz使用./startup.sh启动报错找不到office组件
 
Caused by: java.lang.RuntimeException: 找不到office组件，请确认'office.home'配置是否有误
at cn.keking.service.OfficePluginManager.startOfficeManager(OfficePluginManager.java:56) ~[classes!/:na]
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_201]
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_201]
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_201]
at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_201]
at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessorLifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:389) [spring−beans−5.3.3.jar!/:5.3.3]atorg.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessorLifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:333) ~[spring-beans-5.3.3.jar!/:5.3.3]
at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:157) ~[spring-beans-5.3.3.jar!/:5.3.3]
... 54 common frames omitted
```

解决

```shell
可以尝试到 /tmp/LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS目录执行命令 yum localinstall *.rpm
然后重启kkfileview
```

